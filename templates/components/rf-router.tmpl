{% define "content" %}
<link rel="import" href="/dist/excess-router/excess-router.html">
<link rel="import" href="/dist/iron-icons/iron-icons.html">
<link rel="import" href="/dist/iron-meta/iron-meta.html">
<link rel="import" href="/dist/iron-localstorage/iron-localstorage.html">
<link rel="import" href="/dist/iron-pages/iron-pages.html">
<link rel="import" href="/dist/lazy-pages/lazy-pages.html">
<link rel="import" href="/dist/neon-animation/neon-animated-pages.html">
<link rel="import" href="/dist/neon-animation/neon-animatable.html">
<link rel="import" href="/dist/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="/dist/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="/dist/paper-toast/paper-toast.html">
<link rel="import" href="/dist/polymer/polymer.html">

<link rel="import" href="{% url "/component/rf-splash" .base.r %}">
<link rel="import" href="{% url "/component/rf-api" .base.r %}">
<link rel="import" href="{% url "/component/rf-share-services" .base.r %}">
<link rel="import" href="{% url "/component/rf-keyboard-shortcuts" .base.r %}">

<dom-module id="rf-router">
    <style>
neon-animated-pages, lazy-pages {
    position: static;
}
    </style>

    <template>
		<excess-router-config path-style="path" manual-start="true"></excess-router-config>

		<excess-route route="{% url "/web/:toplevel/(.*)?" .base.r %}" route-alias="toplevel" toplevel="{{ topLevelNavigation }}"></excess-route>
		<excess-route route="/(.*)" redirect-to="{% url "/web/splash" .base.r %}" activation-modifiers="x"></excess-route>

		<excess-route route="{% url "/web/login" .base.r %}" route-alias="login"></excess-route>
		<excess-route route="{% url "/web/login/from/:url" .base.r %}" route-alias="login-from" url="{{ loginRedirect }}"></excess-route>
		<excess-route route="{% url "/web/feed/all" .base.r %}" route-alias="feed-all"></excess-route>

		<excess-route route="{% url "/web/logout" .base.r %}" route-alias="logout"></excess-route>

		<excess-route route="{% url "/web/settings" .base.r %}" route-alias="settings-base"></excess-route>
		<excess-route route="{% url "/web/settings/general" .base.r %}" route-alias="settings-general"></excess-route>
		<excess-route route="{% url "/web/settings/feed/add" .base.r %}" route-alias="settings-add-feed"></excess-route>
		<excess-route route="{% url "/web/settings/feed/add/discover" .base.r %}" route-alias="settings-add-feed-discover"></excess-route>
		<excess-route route="{% url "/web/settings/feed/add/discover/not-found" .base.r %}" route-alias="settings-add-feed-discover-not-found"></excess-route>
		<excess-route route="{% url "/web/settings/feed/add/discover/select" .base.r %}" route-alias="settings-add-feed-discover-select"></excess-route>
		<excess-route route="{% url "/web/settings/feed/add/discover/select/none" .base.r %}" route-alias="settings-add-feed-discover-select-none"></excess-route>
		<excess-route route="{% url "/web/settings/feed/add/discover/select/error" .base.r %}" route-alias="settings-add-feed-discover-select-error"></excess-route>
		<excess-route route="{% url "/web/settings/feed/manage" .base.r %}" route-alias="settings-manage-feeds"></excess-route>
		<excess-route route="{% url "/web/settings/share-services" .base.r %}" route-alias="settings-share-services"></excess-route>
		<excess-route route="{% url "/web/settings/admin" .base.r %}" route-alias="settings-admin"></excess-route>

        <iron-localstorage name="user" value="[[ user ]]" on-iron-localstorage-load="onUserLoad"></iron-localstorage>

        <lazy-pages id="splash" entry-animation="fade-in-animation" exit-animation="fade-out-animation" attr-for-selected="route" selected="[[ topLevelNavigation ]]">
			<rf-splash route="splash"></rf-splash>
			<template is="dom-if" route="login">
				<link rel="import" href="{% url "/component/rf-login" .base.r %}">
				<rf-login></rf-login>
			</template>
			<section route="logout"><!-- Empty section for the logout route to match --></section>
			<template is="dom-if" route="feed">
				<link rel="import" href="{% url "/component/rf-feed-base" .base.r %}">
				<rf-feed-base user="[[ user ]]"></rf-feed-base>
			</template>
			<template is="dom-if" route="settings">
				<link rel="import" href="{% url "/component/rf-settings-base" .base.r %}">
				<rf-settings-base user="[[ user ]]"></rf-settings-base>
			</template>
        </lazy-pages>

        <paper-toast id="api-error"></paper-toast>

        <rf-keyboard-shortcuts></rf-keyboard-shortcuts>
            
        <rf-api id="auth-check" method="get-auth-data"></rf-api>
        <rf-api id="logout" method="logout"></rf-api>
    </template>
    <script src="/js/rf-router.js"></script>
</dom-module>
{% end %}
